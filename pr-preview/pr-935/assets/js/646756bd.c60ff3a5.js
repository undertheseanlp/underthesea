"use strict";(globalThis.webpackChunkunderthesea_docs=globalThis.webpackChunkunderthesea_docs||[]).push([[5507],{4780(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var s=i(9413),r=i(4848),t=i(8453);const l={slug:"rust-text-classifier",title:"Rust-Powered Text Classification - 273x Faster Inference",authors:["rain1024"],tags:["rust","performance","classification","nlp"]},a="Rust-Powered Text Classification: 273x Faster Inference",c={authorsImageUrls:[void 0]},d=[{value:"Background",id:"background",level:2},{value:"The Architecture Change",id:"the-architecture-change",level:2},{value:"Before (sklearn-based)",id:"before-sklearn-based",level:3},{value:"After (Rust-based)",id:"after-rust-based",level:3},{value:"Code Changes",id:"code-changes",level:2},{value:"Benchmark Results",id:"benchmark-results",level:2},{value:"Why Is It Faster?",id:"why-is-it-faster",level:2},{value:"1. Fused Pipeline",id:"1-fused-pipeline",level:3},{value:"2. Optimized Sparse Operations",id:"2-optimized-sparse-operations",level:3},{value:"3. Single File Model",id:"3-single-file-model",level:3},{value:"4. No Python GIL Contention",id:"4-no-python-gil-contention",level:3},{value:"Model Accuracy",id:"model-accuracy",level:2},{value:"Label Format Change",id:"label-format-change",level:2},{value:"Simplified Codebase",id:"simplified-codebase",level:2},{value:"Try It Out",id:"try-it-out",level:2},{value:"Links",id:"links",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["In underthesea v9.2.9, we've completely rewritten the text classification pipeline using our Rust-based ",(0,r.jsx)(n.code,{children:"TextClassifier"}),". This delivers up to ",(0,r.jsx)(n.strong,{children:"273x faster inference"})," compared to the previous sklearn-based implementation."]}),"\n",(0,r.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,r.jsx)(n.p,{children:"Text classification in underthesea supports two domains:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"General"}),": News categorization (10 categories)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bank"}),": Banking intent classification (14 categories)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Previously, we used scikit-learn's ",(0,r.jsx)(n.code,{children:"TfidfVectorizer"})," + ",(0,r.jsx)(n.code,{children:"LinearSVC"})," loaded via joblib. While accurate, this approach had significant overhead."]}),"\n",(0,r.jsx)(n.h2,{id:"the-architecture-change",children:"The Architecture Change"}),"\n",(0,r.jsx)(n.h3,{id:"before-sklearn-based",children:"Before (sklearn-based)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Python                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502    Input     \u2502\u2500\u2500\u2500\u25b6\u2502TfidfVectorizer\u2500\u2500\u2500\u25b6\u2502  LinearSVC   \u2502  \u2502\n\u2502  \u2502    Text      \u2502    \u2502  (sklearn)   \u2502    \u2502  (sklearn)   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                   \u2502          \u2502\n\u2502                      joblib.load()        joblib.load()     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.p,{children:"Loading two separate pickle files, with Python-based vectorization and inference."}),"\n",(0,r.jsx)(n.h3,{id:"after-rust-based",children:"After (Rust-based)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Python                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502    Input     \u2502\u2500\u2500\u2500\u25b6\u2502         TextClassifier           \u2502  \u2502\n\u2502  \u2502    Text      \u2502    \u2502  TF-IDF + LinearSVC (Rust)       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                              \u2502\n\u2502                      single .bin file                       \u2502\n\u2502                      underthesea-core                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.p,{children:"Single binary model file, vectorization and inference fused in Rust."}),"\n",(0,r.jsx)(n.h2,{id:"code-changes",children:"Code Changes"}),"\n",(0,r.jsx)(n.p,{children:"The API remains unchanged:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from underthesea import classify\n\n# General classification\nclassify("Vi\u1ec7t Nam v\xf4 \u0111\u1ecbch AFF Cup")\n# "The thao"\n\n# Bank domain\nclassify("L\xe3i su\u1ea5t ti\u1ebft ki\u1ec7m bao nhi\xeau?", domain="bank")\n# [\'INTEREST_RATE\']\n'})}),"\n",(0,r.jsx)(n.p,{children:"Internally, the implementation is much simpler:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Before:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import joblib\nfrom underthesea.pipeline.classification import bank\n\nvectorizer = joblib.load("vectorizer.pkl")\nclassifier = joblib.load("classifier.pkl")\nfeatures = vectorizer.transform([text])\nprediction = classifier.predict(features)\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from underthesea_core import TextClassifier\n\nclassifier = TextClassifier.load("model.bin")\nprediction = classifier.predict(text)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"benchmark-results",children:"Benchmark Results"}),"\n",(0,r.jsx)(n.p,{children:"Tested on the same hardware with batch inference:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Domain"}),(0,r.jsx)(n.th,{children:"sklearn"}),(0,r.jsx)(n.th,{children:"Rust"}),(0,r.jsx)(n.th,{children:"Speedup"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"General"}),(0,r.jsx)(n.td,{children:"1,228 samples/sec"}),(0,r.jsx)(n.td,{children:"66,678 samples/sec"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"54x"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Bank"}),(0,r.jsx)(n.td,{children:"244 samples/sec"}),(0,r.jsx)(n.td,{children:"66,678 samples/sec"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"273x"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Single sample latency: ",(0,r.jsx)(n.strong,{children:"4ms \u2192 0.465ms"})]}),"\n",(0,r.jsx)(n.h2,{id:"why-is-it-faster",children:"Why Is It Faster?"}),"\n",(0,r.jsx)(n.h3,{id:"1-fused-pipeline",children:"1. Fused Pipeline"}),"\n",(0,r.jsx)(n.p,{children:"TF-IDF vectorization and SVM inference run in a single Rust function call, eliminating Python overhead between stages."}),"\n",(0,r.jsx)(n.h3,{id:"2-optimized-sparse-operations",children:"2. Optimized Sparse Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"pub fn predict(&self, text: &str) -> String {\n    // Tokenize and hash features in one pass\n    let features = self.vectorizer.transform(text);\n\n    // Sparse dot product with pre-sorted indices\n    let scores = self.svm.decision_function(&features);\n\n    self.classes[scores.argmax()].clone()\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-single-file-model",children:"3. Single File Model"}),"\n",(0,r.jsxs)(n.p,{children:["One ",(0,r.jsx)(n.code,{children:".bin"})," file instead of multiple pickle files:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Faster loading"}),"\n",(0,r.jsx)(n.li,{children:"Atomic deployment"}),"\n",(0,r.jsx)(n.li,{children:"Smaller size (JSON-based, not pickle)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-no-python-gil-contention",children:"4. No Python GIL Contention"}),"\n",(0,r.jsx)(n.p,{children:"Rust code releases the GIL during computation, enabling true parallelism."}),"\n",(0,r.jsx)(n.h2,{id:"model-accuracy",children:"Model Accuracy"}),"\n",(0,r.jsx)(n.p,{children:"The new models maintain high accuracy:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Dataset"}),(0,r.jsx)(n.th,{children:"Categories"}),(0,r.jsx)(n.th,{children:"Accuracy"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"VNTC"}),(0,r.jsx)(n.td,{children:"10 news topics"}),(0,r.jsx)(n.td,{children:"92.49%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Bank"}),(0,r.jsx)(n.td,{children:"14 banking intents"}),(0,r.jsx)(n.td,{children:"75.76%"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"label-format-change",children:"Label Format Change"}),"\n",(0,r.jsx)(n.p,{children:"Labels now use Title case with spaces:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Old"}),(0,r.jsx)(n.th,{children:"New"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"the_thao"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"The thao"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kinh_doanh"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Kinh doanh"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vi_tinh"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Vi tinh"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Bank domain labels remain uppercase: ",(0,r.jsx)(n.code,{children:"INTEREST_RATE"}),", ",(0,r.jsx)(n.code,{children:"MONEY_TRANSFER"}),", etc."]}),"\n",(0,r.jsx)(n.h2,{id:"simplified-codebase",children:"Simplified Codebase"}),"\n",(0,r.jsx)(n.p,{children:"We consolidated three separate modules into one:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Before:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"classification/\n\u251c\u2500\u2500 bank/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 sonar_core_1/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 vntc/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u2514\u2500\u2500 __init__.py\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"After:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"classification/\n\u251c\u2500\u2500 __init__.py      # Everything here\n\u2514\u2500\u2500 classification_prompt.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"~190 lines removed, single source of truth for model URLs and loading logic."}),"\n",(0,r.jsx)(n.h2,{id:"try-it-out",children:"Try It Out"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install underthesea==9.2.9\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from underthesea import classify\n\n# 273x faster!\nclassify(\"Th\u1ecb tr\u01b0\u1eddng ch\u1ee9ng kho\xe1n t\u0103ng \u0111i\u1ec3m m\u1ea1nh\")\n# \"Kinh doanh\"\n\nclassify.labels\n# ['Chinh tri Xa hoi', 'Doi song', 'Khoa hoc', 'Kinh doanh', ...]\n\nclassify(\"M\u1edf th\u1ebb t\xedn d\u1ee5ng\", domain=\"bank\")\n# ['CARD']\n\nclassify.bank.labels\n# ['ACCOUNT', 'CARD', 'CUSTOMER_SUPPORT', ...]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/undertheseanlp/underthesea/pull/935",children:"PR #935"})," - Classification pipeline refactor"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/undertheseanlp/sen-1",children:"Sen-1"})," - Training code and technical report"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://pypi.org/project/underthesea-core/",children:"underthesea-core"})," - Rust extension on PyPI"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>a});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},9413(e){e.exports=JSON.parse('{"permalink":"/blog/rust-text-classifier","editUrl":"https://github.com/undertheseanlp/underthesea/tree/main/docusaurus/blog/2026-02-03-rust-text-classifier.md","source":"@site/blog/2026-02-03-rust-text-classifier.md","title":"Rust-Powered Text Classification - 273x Faster Inference","description":"In underthesea v9.2.9, we\'ve completely rewritten the text classification pipeline using our Rust-based TextClassifier. This delivers up to 273x faster inference compared to the previous sklearn-based implementation.","date":"2026-02-03T00:00:00.000Z","tags":[{"inline":true,"label":"rust","permalink":"/blog/tags/rust"},{"inline":true,"label":"performance","permalink":"/blog/tags/performance"},{"inline":true,"label":"classification","permalink":"/blog/tags/classification"},{"inline":true,"label":"nlp","permalink":"/blog/tags/nlp"}],"readingTime":2.5,"hasTruncateMarker":true,"authors":[{"name":"Vu Anh","title":"Creator of Underthesea","url":"https://github.com/rain1024","imageURL":"https://github.com/rain1024.png","key":"rain1024","page":null}],"frontMatter":{"slug":"rust-text-classifier","title":"Rust-Powered Text Classification - 273x Faster Inference","authors":["rain1024"],"tags":["rust","performance","classification","nlp"]},"unlisted":false,"nextItem":{"title":"Rewriting CRF Model in Rust - 20% Performance Boost","permalink":"/blog/rewrite-rust-crf-model"}}')}}]);